export default (store, plugins) => {
  store.doStartLoadingPlugins();
  const loaded = [];

  // make sure we even get plugins
  if (plugins && plugins.length) {
    plugins.forEach((p) => {
      const sig = btoa(p.pluginName);

      // make sure we haven't loaded a plugin with this name yet.
      if (loaded.indexOf(sig) === -1) {
        // add any bundles that come along with the plugin
        if (p.bundle) {
          // we provide a single bundle or an array of bundles, either way, make it an array here
          if (!p.bundle.length) p.bundle = [p.bundle];
          p.bundle.forEach((b) => {
            store.integrateBundles(b);
          });
        }

        // add any UI components that come along with the plugin
        if (p.hasOwnProperty("components")) {
          store.doAddPluginComponents(p.components);
        }

        // mark this one as loaded
        loaded.push(sig);
      }
    });
  }
  store.doStopLoadingPlugins();
};
