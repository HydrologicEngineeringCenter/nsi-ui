/* eslint jsx-a11y/anchor-is-valid: 0 */
import React from 'react';
import { connect } from 'redux-bundler-react';
import classnames from 'classnames';
import moment from 'moment';

class CatalogListItem extends React.Component {
  handleClick = (e) => {
    const { active, item, doAddLayer, treeViewRootId } = this.props;
    if(!active){
      item.parentUid = treeViewRootId;
      item.visible = true;
      doAddLayer(item);
    }
  }

  setSearchTerm = (e) => {
    e.stopPropagation();
    const val = e.currentTarget.innerText;
    const { onSetSearchTerm } = this.props;
    onSetSearchTerm(val);
  }

  render(){
    const { active, item, theme } = this.props;
    const { keywords } = item;
    const keywordArray = keywords ? keywords.split(',') : [];
    if(item.nationalData) keywordArray.push('National Data');

    const iconClass = classnames({
      'dataset-list-icon': true,
      'pull-left': true,
      'dataset-national': item.national,
      'ms': true,
      'ms-points': item.geometryType === 'POINT',
      'ms-line': item.geometryType === 'LINE',
      'ms-polygon': item.geometryType === 'POLYGON',
      'ms ms-shp': item.geometryType === 'SERVICE'
    })

    const listItemClass = classnames({
      "cm-list-group-item": true,
      "dataset-list-item": true,
      [theme]: active
    })

    const Rows = <span className="info-item" >{item.numRows ? `(${item.numRows})` : null}</span>
    const DateAdded = <span className="info-item" >{moment(item.createDate,'YYYY-MM-DDTh:mm:ssZ').fromNow()}</span>
    const AddedBy = <span title={'Added to ' + item.teamName + ' by ' + item.createdByUsername} className="info-item">{item.createdByUsername}</span>
    const AddedTo = <a onClick={this.setSearchTerm} title={'Added to ' + item.teamName + ' by ' + item.createdByUsername} data-filter="true" key={item.id + '-teamName'} className="keyword-pill">{item.teamName}</a>

    return (
      <li onClick={this.handleClick} className={listItemClass}>
        <div className="row">
          <span className="col-xs-1"><i className={iconClass}></i></span>
          <span className="col-xs-5 dataset-display-name">{item.displayName}
            <div className="dataset-list-description">{item.description}</div>
          </span>
          <span className="col-xs-6 align-right">
            {Rows}
            {DateAdded}
            {AddedBy}
            {AddedTo}
            <div>
              {
                keywordArray.map((keyword, i) => {
                  return <span onClick={this.setSearchTerm} key={i} className="label label-default" style={{marginRight:'3px'}}>{keyword}</span>
                })
              }
            </div>
          </span>
        </div>
      </li>
    )
  }
}

export default connect(
  'selectTheme',
  'selectTreeViewRootId',
  'doAddLayer',
  CatalogListItem
);