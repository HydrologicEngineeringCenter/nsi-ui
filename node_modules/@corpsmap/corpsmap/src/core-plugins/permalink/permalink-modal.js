import React from 'react';
import { connect } from 'redux-bundler-react';

class PermalinkModal extends React.Component {
  constructor(props){
    super(props);
    this.close = this.close.bind(this);
    this.constructQueryString = this.constructQueryString.bind(this);
  }

  close() {
    const { doModalClose } = this.props;
    doModalClose();
  }

  constructQueryString(){
    const { viewState, visibleCmLayers, windowLocationOrigin: origin, windowLocationPathname: pathname } = this.props;
    const url = `${origin}${pathname}?`;
    const paramPairs = [];

    if(visibleCmLayers.length) paramPairs.push(`layers=${visibleCmLayers.join(',')}`);

    paramPairs.push(`x=${Math.round(viewState.center[0] * 1000) / 1000}`);
    paramPairs.push(`y=${Math.round(viewState.center[1] * 1000) / 1000}`);
    paramPairs.push(`z=${Math.round(viewState.zoom)}`);

    return `${url}${paramPairs.join('&')}`;
  }

  render() {
    const { theme } = this.props;
    const url = this.constructQueryString();
    return (
      <div>
        <div className={"modal-header " + theme}>
          Copy Permalink
        </div>
        <div
          className="modal-body"
          style={{ height: 200, top: 0, bottom: 0, left: 0, right: 0 }}
        >
          <p>
            Copy the link below to send a permalink to other users or save for later use.
          </p>
          <p>
            The query parameters at the end of the link are used to configure the map so that it zooms to a location or turns layers on.
          </p>
          <p>
            <strong>
              <a href={url}>
                { url }
              </a>
            </strong>
          </p>
          <p>
            Right click the link above, choose "Copy Link Address"
          </p>
        </div>
        <div className="modal-footer">
          <button className={"btn btn-theme " + theme} onClick={this.close}>
            Close
          </button>
        </div>
      </div>
    )
  }
}

export default connect(
  'selectTheme',
  'selectViewState',
  'selectVisibleCmLayers',
  'selectWindowLocationOrigin',
  'selectWindowLocationPathname',
  'doModalClose',
  PermalinkModal
)